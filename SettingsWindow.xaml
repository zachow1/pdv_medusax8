<Window x:Class="PDV_MedusaX8.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Configurações"
        x:Name="SettingsWin"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResize"
        SizeToContent="Manual"
        Width="800" Height="600"
        ShowInTaskbar="False">

    <Window.Resources>
        <Color x:Key="CorFundoApp">#fffafa</Color>
        <Color x:Key="CorPrimariaAcao">#007bff</Color>
        <Color x:Key="CorFinalizar">#28a745</Color>
        <Color x:Key="CorCancelar">#dc3545</Color>
        <SolidColorBrush x:Key="CorBorda" Color="#e0e0e0"/>
        <Color x:Key="CorTexto">#333333</Color>

        <SolidColorBrush x:Key="BrFundoApp" Color="{StaticResource CorFundoApp}"/>
        <SolidColorBrush x:Key="BrPrimariaAcao" Color="{StaticResource CorPrimariaAcao}"/>
        <SolidColorBrush x:Key="BrFinalizar" Color="{StaticResource CorFinalizar}"/>
        <SolidColorBrush x:Key="BrCancelar" Color="{StaticResource CorCancelar}"/>
        <SolidColorBrush x:Key="BrTexto" Color="{StaticResource CorTexto}"/>
    </Window.Resources>

    <Border Background="{StaticResource BrFundoApp}" BorderBrush="{StaticResource CorBorda}" BorderThickness="1" Padding="10">
        <DockPanel>
            <TabControl>
                <TabItem Header="Forma de Pagamentos">
                    <Grid Margin="5">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <DataGrid Name="DgPaymentMethods" Grid.Row="0" AutoGenerateColumns="False" IsReadOnly="False"
                                  CanUserAddRows="False" CanUserDeleteRows="False"
                                  AllowDrop="True"
                                  CanUserSortColumns="False"
                                  PreviewMouseLeftButtonDown="DgPaymentMethods_PreviewMouseLeftButtonDown"
                                  MouseMove="DgPaymentMethods_MouseMove"
                                  DragOver="DgPaymentMethods_DragOver"
                                  Drop="DgPaymentMethods_Drop"
                                  CellEditEnding="DgPaymentMethods_CellEditEnding">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Código" Binding="{Binding Code}" IsReadOnly="True" Width="120"/>
                                <DataGridTextColumn Header="Descrição" Binding="{Binding Name}" Width="*"/>
                                <DataGridTextColumn Header="Ordem" Binding="{Binding DisplayOrder, Mode=OneWay}" IsReadOnly="True" Width="80"/>
                                <DataGridCheckBoxColumn Header="Ativo" Binding="{Binding IsEnabled}" Width="100"/>
                                <DataGridComboBoxColumn Header="Vínculo" Width="120"
                                                        SelectedItemBinding="{Binding LinkType, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                        ItemsSource="{Binding ElementName=SettingsWin, Path=LinkTypes}"/>
                            </DataGrid.Columns>
                        </DataGrid>

                        <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
                            <Button Content="Salvar" Background="{StaticResource BrFinalizar}" Foreground="White" Click="SavePayments"/>
                            <Button Content="Fechar" Margin="8,0,0,0" Background="{StaticResource BrCancelar}" Foreground="White" Click="CloseSettings"/>
                        </StackPanel>
                    </Grid>
                </TabItem>

                <TabItem Header="NFC-e">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        
                        <StackPanel Grid.Row="0" Orientation="Vertical" Margin="0,0,0,10">
                            <TextBlock Text="Configurações de NFC-e" FontWeight="Bold" Margin="0,0,0,8"/>
                            
                            <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                <TextBlock Text="Certificado:" Width="120" VerticalAlignment="Center"/>
                                <TextBox Name="TxtCert" IsReadOnly="True" Width="400"/>
                                <Button Content="Selecionar..." Margin="8,0,0,0" Click="SelectCert_Click"/>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                <TextBlock Text="Ambiente:" Width="120" VerticalAlignment="Center"/>
                                <ComboBox Name="CmbEnvironment" Width="200" SelectedValuePath="Content">
                                    <ComboBoxItem Content="Homolog"/>
                                    <ComboBoxItem Content="Producao"/>
                                </ComboBox>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                <TextBlock Text="Número do caixa:" Width="120" VerticalAlignment="Center"/>
                                <TextBox Name="TxtCashRegister" Width="120" PreviewTextInput="NumericOnly_PreviewTextInput"/>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                <TextBlock Text="Série NFC-e:" Width="120" VerticalAlignment="Center"/>
                                <TextBox Name="TxtSerie" Width="120" PreviewTextInput="NumericOnly_PreviewTextInput"/>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                <TextBlock Text="Próxima nota:" Width="120" VerticalAlignment="Center"/>
                                <TextBox Name="TxtNextNumber" Width="120" PreviewTextInput="NumericOnly_PreviewTextInput"/>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                <TextBlock Text="CSC Id:" Width="120" VerticalAlignment="Center"/>
                                <TextBox Name="TxtCSCId" Width="160"/>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                <TextBlock Text="CSC:" Width="120" VerticalAlignment="Center"/>
                                <TextBox Name="TxtCSC" Width="320"/>
                            </StackPanel>
                        </StackPanel>

                        <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Content="Salvar Configuração" Click="SaveNFCeConfig_Click" Background="{StaticResource BrFinalizar}" Foreground="White"/>
                        </StackPanel>
                    </Grid>
                </TabItem>

                <!-- NOVA ABA: TEF -->
                <TabItem Header="TEF">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Row="0" Orientation="Vertical" Margin="0,0,0,10">
                            <TextBlock Text="Configurações de TEF" FontWeight="Bold" Margin="0,0,0,8"/>
                            <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                <TextBlock Text="Tipo de Integração:" Width="150" VerticalAlignment="Center"/>
                                <ComboBox Name="CmbTEFType" Width="260" SelectedValuePath="Content">
                                    <ComboBoxItem Content="Nenhum"/>
                                    <ComboBoxItem Content="Sitef (CliSiTef)"/>
                                    <ComboBoxItem Content="PayGo"/>
                                    <ComboBoxItem Content="Cappta"/>
                                    <ComboBoxItem Content="Stone"/>
                                    <ComboBoxItem Content="VeSPague"/>
                                    <ComboBoxItem Content="Scope"/>
                                    <ComboBoxItem Content="TPag"/>
                                    <ComboBoxItem Content="Elgin"/>
                                    <ComboBoxItem Content="Banese"/>
                                    <ComboBoxItem Content="Discado"/>
                                </ComboBox>
                            </StackPanel>

                            <!-- Campo genérico: Scope -->
                            <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                                <TextBlock Text="Scope:" Width="150" VerticalAlignment="Center"/>
                                <TextBox Name="TxtTEFScope" Width="260"/>
                            </StackPanel>

                            <!-- Campos específicos do SiTef -->
                            <TextBlock Text="Configurações SiTef (CliSiTef)" FontWeight="Bold" Margin="0,12,0,4"/>
                            <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                <TextBlock Text="SiTef IP:" Width="150" VerticalAlignment="Center"/>
                                <TextBox Name="TxtSitefIP" Width="260"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                <TextBlock Text="SiTef Loja:" Width="150" VerticalAlignment="Center"/>
                                <TextBox Name="TxtSitefLoja" Width="260"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                <TextBlock Text="SiTef Terminal:" Width="150" VerticalAlignment="Center"/>
                                <TextBox Name="TxtSitefTerminal" Width="260"/>
                            </StackPanel>

                            <!-- Pasta de Troca -->
                            <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                <TextBlock Text="Pasta de Troca (TEF):" Width="150" VerticalAlignment="Center"/>
                                <TextBox Name="TxtTEFExchangePath" Width="260"/>
                            </StackPanel>
                        </StackPanel>

                        <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right">
                            <CheckBox Name="ChkTEFDebug" Content="Modo Debug (gerar resposta local)" VerticalAlignment="Center" Margin="0,0,16,0"/>
                            <Button Content="Testar TEF (Debug)" Click="DebugTEF_Click" Background="{StaticResource BrFinalizar}" Foreground="White" Margin="0,0,8,0"/>
                            <Button Content="Salvar TEF" Click="SaveTEFConfig_Click" Background="{StaticResource BrFinalizar}" Foreground="White"/>
                        </StackPanel>
                    </Grid>
                </TabItem>

                <TabItem Header="Geral">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <StackPanel Grid.Row="0" Orientation="Vertical">
                            <CheckBox Name="ChkImportERPOrders" Content="Importar pedido de venda do ERP"/>
                        </StackPanel>
                        <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Content="Salvar Geral" Click="SaveGeneral_Click" Background="{StaticResource BrFinalizar}" Foreground="White"/>
                        </StackPanel>
                    </Grid>
                </TabItem>

                <TabItem Header="Opções">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid Grid.Row="0" Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0" Orientation="Vertical">
                                <CheckBox Name="ChkEnableF9" Content="Permitir alterar preço unitário com F9"/>
                                <CheckBox Name="ChkPromptConsumer" Content="Solicitar consumidor ao iniciar a venda?"/>
                                <CheckBox Name="ChkRequireF2ToStartSale" Content="Exigir F2 para iniciar venda"/>
                                <CheckBox Name="ChkRequireSupervisorForSangria" Content="Exigir supervisor para sangria"/>

                                <Separator Margin="0,12,0,12"/>
                                <TextBlock Text="Importar pedido ERP (Opções)" FontWeight="Bold"/>

                                <StackPanel Orientation="Vertical" Margin="0,6,0,0">
                                    <TextBlock Text="Nome do Cliente"/>
                                    <TextBox Name="TxtOptCliente" Width="260"/>
                                </StackPanel>

                                <StackPanel Orientation="Vertical" Margin="0,6,0,0">
                                    <TextBlock Text="Número do Pedido"/>
                                    <TextBox Name="TxtOptNumeroPedido" Width="200"/>
                                </StackPanel>

                                <StackPanel Orientation="Vertical" Margin="0,6,0,0">
                                    <TextBlock Text="Valor da Compra"/>
                                    <TextBox Name="TxtOptValorCompra" Width="160"/>
                                </StackPanel>

                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
                                    <Button Content="Importar" Click="ImportERPInOptions_Click" Background="{StaticResource BrFinalizar}" Foreground="White"/>
                                    <Button Content="Limpar" Click="ClearERPForm_Click" Margin="8,0,0,0" Background="{StaticResource BrCancelar}" Foreground="White"/>
                                </StackPanel>
                            </StackPanel>
                            <StackPanel Grid.Column="1" Orientation="Vertical" Margin="20,0,0,0">
                                <TextBlock Text="Desconto máximo (%)" VerticalAlignment="Center"/>
                                <TextBox Name="TxtMaxDiscountPercent" Width="100"/>
                            </StackPanel>
                        </Grid>
                        <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Content="Salvar Opções" Click="SaveOptions_Click" Background="{StaticResource BrFinalizar}" Foreground="White"/>
                        </StackPanel>
                    </Grid>
                </TabItem>

                <!-- Nova aba: Impressão -->
                <TabItem Header="Impressão">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Row="0" Orientation="Vertical" Margin="0,0,0,10">
                            <TextBlock Text="Selecionar impressoras por tipo de documento" FontWeight="Bold" Margin="0,0,0,8"/>

                            <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                <TextBlock Text="Boleto:" Width="180" VerticalAlignment="Center"/>
                                <ComboBox Name="CmbPrinterBoleto" Width="300"/>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                <TextBlock Text="Confissão de dívida:" Width="180" VerticalAlignment="Center"/>
                                <ComboBox Name="CmbPrinterConfissao" Width="300"/>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                <TextBlock Text="NFCe:" Width="180" VerticalAlignment="Center"/>
                                <ComboBox Name="CmbPrinterNFCe" Width="300"/>
                            </StackPanel>

                            <Separator Margin="0,10,0,10"/>
                            <TextBlock Text="Carnê (Crédito em Loja)" FontWeight="Bold"/>

                            <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                <TextBlock Text="Impressora 80mm:" Width="180" VerticalAlignment="Center"/>
                                <ComboBox Name="CmbPrinterCarne80" Width="300"/>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                <TextBlock Text="Impressora A4:" Width="180" VerticalAlignment="Center"/>
                                <ComboBox Name="CmbPrinterCarneA4" Width="300"/>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                <TextBlock Text="Formato padrão do Carnê:" Width="180" VerticalAlignment="Center"/>
                                <ComboBox Name="CmbCarneFormatoPadrao" Width="160" SelectedValuePath="Content">
                                    <ComboBoxItem Content="80mm"/>
                                    <ComboBoxItem Content="A4"/>
                                </ComboBox>
                            </StackPanel>
                        </StackPanel>

                        <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Content="Salvar Impressoras" Background="{StaticResource BrFinalizar}" Foreground="White" Click="SavePrinterSettings_Click"/>
                        </StackPanel>
                    </Grid>
                </TabItem>
            </TabControl>
        </DockPanel>
    </Border>
</Window>